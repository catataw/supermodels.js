!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.supermodels=e()}}(function(){var e,t,r;return function e(t,r,n){function i(s,o){if(!r[s]){if(!t[s]){var u=typeof require=="function"&&require;if(!o&&u)return u(s,!0);if(a)return a(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var c=r[s]={exports:{}};t[s][0].call(c.exports,function(e){var r=t[s][1][e];return i(r?r:e)},c,c.exports,e,t,r,n)}return r[s].exports}var a=typeof require=="function"&&require;for(var s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){var n=e("emitter-object");var i=e("emitter-event");var a=e("emitter-array");var s=e("./model");var o="__validators";var u="__value";var f="__type";var c="__get";var l="__set";var p="__configurable";var h="__enumerable";var v=[o,u,f,c,l,p,h];var _={typeOf:function(e){return Object.prototype.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},isObject:function(e){return this.typeOf(e)==="object"},isArray:function(e){return Array.isArray(e)},isSimple:function(e){return!this.isObject(e)&&!this.isArray(e)},isFunction:function(e){return this.typeOf(e)==="function"},isDate:function(e){return this.typeOf(e)==="date"},isSpecialProp:function(e){return v.indexOf(e)!==-1},getProps:function(e){if(!this.isObject(e)){return null}return Object.keys(e).filter(function(e){return!this.isSpecialProp(e)},this)},getSpecialProps:function(e){if(!this.isObject(e)){return null}return Object.keys(e).filter(function(e){return this.isSpecialProp(e)},this)},hasProps:function(e){var t=this.getProps(e);return t&&!!t.length},hasSpecialProps:function(e){var t=this.getSpecialProps(e);return t&&!!t.length},hasOnlySpecialProps:function(e){if(!this.isObject(e)){return false}var t=Object.keys(e);return t.every(function(e){return v.indexOf(e)!==-1})},hasMixedProps:function(e){return this.hasSpecialProps(e)&&!this.hasOnlySpecialProps(e)},hasNoSpecialProps:function(e){return!this.hasSpecialProps(e)},cast:function(e,t){switch(t){case String:{if(e===undefined||e===null||_.typeOf(e)==="string"){return e}return e.toString&&e.toString()}break;case Number:{if(e===undefined||e===null){return NaN}if(_.typeOf(e)==="number"){return e}return Number(e)}break;case Boolean:{if(!e){return false}var r=["0","false","off","no"];return r.indexOf(e)===-1}break;case Date:{if(e===undefined||e===null||_.typeOf(e)==="date"){return e}return new Date(e)}break;default:return e}},resolveDescriptorValue:function(e){switch(e.value){case String:case Number:case Boolean:case Date:return{__type:e.value};default:return e.value}}};function y(e,t,r,s,v){var y=_.resolveDescriptorValue(t);if(_.isFunction(y)){r[e]=y;return}var g=_.isArray(y);var P=_.isObject(y);var A=_.hasProps(y);var S=_.hasOnlySpecialProps(y);var x=_.hasSpecialProps(y);var L=!g&&!P;var D=x&&typeof y[p]!=="undefined"?y[p]:t.configurable;var E=x&&typeof y[h]!=="undefined"?y[h]:t.enumerable;var N=t.get||x&&y[c];var V=t.set||x&&y[l];var q=!!N;var F=!!V;var R={configurable:D,enumerable:E,get:function(){return q?N.call(this):s[e]}};if(F||L&&!q||S){R.set=function(t){var r=s[e];if(F){V.call(this,t)}else{s[e]=_.cast(t,y&&y[f])}var n=this[e];this.emit("change",new i("change",this,{name:e,value:n,oldValue:r}));this.emit("change:"+e,new i("change:"+e,this,{value:n,oldValue:r}));var a;for(var o=0;o<this.__ancestors.length;o++){a=this.__path+"."+e;this.__ancestors[o].emit("change",new i("change",this,{name:a,value:n,oldValue:r}));this.__ancestors[o].emit("change:"+a,new i("change:"+a,this,{name:a,value:n,oldValue:r}))}}}Object.defineProperty(r,e,R);if(S&&_.isArray(y[o])){j(y[o],v,e)}if(g){var B=a(function(e,t,r){B.emit("change",new i("change",B,O({type:e},r)));B.emit(e,new i(e,B,r));for(var n=0;n<B.__ancestors.length;n++){B.__ancestors[n].emit("change",new i("change",B,O({name:B.__path,type:e},r)))}});n(B);Object.defineProperties(B,m(r));if(y.length){var C=b(B);d(B,C);B.create=function(){var e=Object.create(C);k(y[0],e);return e}}s[e]=B}else if(A){s[e]=w(y,r)}else if(L){s[e]=y}else if(y&&y.hasOwnProperty(u)){s[e]=y[u]}}function g(e,t){var r;for(var n=0;n<t.length;n++){r=t[n];if(!e.isPrototypeOf(r)){throw new Error("Invalid type")}}}function d(e,t){var r=e.push;var n=e.unshift;var i=e.splice;if(r){e.push=function(){g(t,arguments);return r.apply(e,arguments)}}if(n){e.unshift=function(){g(t,arguments);return n.apply(e,arguments)}}if(i){e.splice=function(){g(t,Array.prototype.slice.call(arguments,2));return i.apply(e,arguments)}}}function m(e){var t=O({__parent:{value:e,enumerable:false,writable:false,configurable:false}},s);return t}function b(e){var t=m(e);var r=Object.create({},t);n(r);return r}function O(e,t){if(e&&t){for(var r in e){t[r]=e[r]}}return t}function j(e,t,r){var n,i;for(var a=0;a<e.length;a++){i=e[a];if(_.isFunction(i)){n={test:i}}else{n=O(i,{})}if(r){n.key=r}t.push(n)}}function k(e,t){var r={};var n=Object.keys(e);var i=[];for(var a=0;a<n.length;a++){var s=n[a];if(o===s){j(e[s],i)}else{var u=Object.getOwnPropertyDescriptor(e,s);y(s,u,t,r,i)}}Object.defineProperty(t,"__validators",{value:i})}function w(e,t){var r=b(t);k(e,r);return r}t.exports=w},{"./model":2,"emitter-array":3,"emitter-event":6,"emitter-object":7}],2:[function(e,t,r){var n=e("./validation-error");var i={__supermodel:{value:true},__keys:{get:function(){var e=Object.keys(this);var t=["addEventListener","on","once","removeEventListener","removeAllListeners","removeListener","off","emit","listeners","hasListeners","pop","push","reverse","shift","sort","splice","update","unshift","create"];e=e.filter(function(e){return t.indexOf(e)<0});return e}},__name:{get:function(){if(this.__isRoot){return""}var e=this.__parent.__keys;var t,r,n;for(var i=0;i<e.length;i++){t=e[i];r=this.__parent[t];n=Array.isArray(r);if(r===this){return t}}}},__ancestors:{get:function(){var e=[],t=this;while(t.__parent){e.push(t.__parent);t=t.__parent}return e}},__descendants:{get:function(){var e=[];function t(r){var n=r.__keys;var i,a;for(var s=0;s<n.length;s++){i=n[s];a=r[i];if(a&&a.__supermodel){e.push(a);t(a)}}}t(this);return e}},__children:{get:function(){var e=[];var t=this.__keys;var r,n;for(var i=0;i<t.length;i++){r=t[i];n=this[r];if(n&&n.__supermodel){e.push(n)}}return e}},__isRoot:{get:function(){return!this.__hasAncestors}},__hasAncestors:{get:function(){return!!this.__ancestors.length}},__path:{get:function(){if(this.__hasAncestors&&!this.__parent.__isRoot){return this.__parent.__path+"."+this.__name}else{return this.__name}}},__hasDecendants:{get:function(){return!!this.__descendants.length}},errors:{get:function(){var e=[];var t=this.__validators;var r,i,a,s,o;if(t){for(o=0;o<t.length;o++){r=t[o];i=r.key;a=r.test.call(this,i?this[i]:this,i);if(a){e.push(new n(this,a,r,i))}}}for(o=0;o<this.__children.length;o++){s=this.__children[o];Array.prototype.push.apply(e,s.errors)}return e}}};t.exports=i},{"./validation-error":8}],3:[function(e,t,r){var n=e("emitter-object");var i=e("emitter-event");function a(e,t,r){var n=new i(e,t,r);t.emit(e,n);t.emit("change",n)}t.exports=function(e){e=e||raiseEvent;var t=arguments;var r=[];if(!e)n(r);var i=function(){var t=Array.prototype.pop.apply(r);e("pop",r,{value:t});return t};var a=function(){var t=Array.prototype.push.apply(r,arguments);e("push",r,{value:t});return t};var s=function(){var t=Array.prototype.reverse.apply(r);e("reverse",r,{value:t});return t};var o=function(){var t=Array.prototype.shift.apply(r);e("shift",r,{value:t});return t};var u=function(){var t=Array.prototype.sort.apply(r,arguments);e("sort",r,{value:t});return t};var f=function(){var t=Array.prototype.unshift.apply(r,arguments);e("unshift",r,{value:t});return t};var c=function(){if(!arguments.length){return}var t=Array.prototype.splice.apply(r,arguments);e("splice",r,{value:t,removed:t,added:Array.prototype.slice.call(arguments,2)});return t};r.pop=r.pop&&i;r.push=r.push&&a;r.reverse=r.reverse&&s;r.shift=r.shift&&o;r.sort=r.sort&&u;r.splice=r.splice&&c;r.update=function(t,n){var i=r[t];var a=r[t]=n;e("update",r,{value:a,oldValue:i});return a};return r}},{"emitter-event":4,"emitter-object":5}],4:[function(e,t,r){t.exports=function e(t,r,n){this.name=t;this.target=r;if(n){this.detail=n}}},{}],5:[function(e,t,r){t.exports=n;function n(e){var t=e||this;var r;Object.defineProperty(t,"__callbacks",{get:function(){return r=r||{}},set:function(e){r=e}});if(e){t=i(e);return t}}function i(e){for(var t in n.prototype){e[t]=n.prototype[t]}return e}n.prototype.on=n.prototype.addEventListener=function(e,t){(this.__callbacks[e]=this.__callbacks[e]||[]).push(t);return this};n.prototype.once=function(e,t){function r(){this.off(e,r);t.apply(this,arguments)}r.fn=t;this.on(e,r);return this};n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(0==arguments.length){this.__callbacks={};return this}var r=this.__callbacks[e];if(!r)return this;if(1==arguments.length){delete this.__callbacks[e];return this}var n;for(var i=0;i<r.length;i++){n=r[i];if(n===t||n.fn===t){r.splice(i,1);break}}return this};n.prototype.emit=function(e){var t=[].slice.call(arguments,1),r=this.__callbacks[e];if(r){r=r.slice(0);for(var n=0,i=r.length;n<i;++n){r[n].apply(this,t)}}return this};n.prototype.listeners=function(e){return this.__callbacks[e]||[]};n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],6:[function(e,t,r){arguments[4][4][0].apply(r,arguments)},{dup:4}],7:[function(e,t,r){arguments[4][5][0].apply(r,arguments)},{dup:5}],8:[function(e,t,r){function n(e,t,r,n){this.target=e;this.error=t;this.validator=r;if(n){this.key=n}}t.exports=n},{}]},{},[1])(1)});