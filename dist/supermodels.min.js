!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.supermodels=e()}}(function(){var e,t,r;return function e(t,r,n){function i(s,u){if(!r[s]){if(!t[s]){var o=typeof require=="function"&&require;if(!u&&o)return o(s,!0);if(a)return a(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var l=r[s]={exports:{}};t[s][0].call(l.exports,function(e){var r=t[s][1][e];return i(r?r:e)},l,l.exports,e,t,r,n)}return r[s].exports}var a=typeof require=="function"&&require;for(var s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){t.exports=e("./lib/supermodels")},{"./lib/supermodels":10}],2:[function(e,t,r){"use strict";var n=e("./util");var i=e("./factory");function a(e){var t=n.isConstructor(e);var r=n.isSupermodelConstructor(e);var i=n.isArray(e);if(t||r||i){return{__type:e}}var a=!n.isObject(e);if(a){return{__value:e}}return e}function s(e){e=a(e);var t="__validators",r="__value",u="__type",o="__displayName",f="__get",l="__set",c="__enumerable",p="__configurable",_="__writable",h=[t,r,u,o,f,l,c,p,_];var v={from:e,type:e[u],value:e[r],validators:e[t]||[],enumerable:e[c]===false?false:true,configurable:e[p]?true:false,writable:e[_]===false?false:true,displayName:e[o],getter:e[f],setter:e[l]};var d=v.type;if(n.isSimpleConstructor(d)){v.isSimple=true;v.cast=function(e){return n.cast(e,d)}}else if(n.isSupermodelConstructor(d)){v.isReference=true}else if(v.value){v.isSimple=true}else{var y=Object.keys(e);var g=y.filter(function(e){return h.indexOf(e)===-1});if(g.length){var m={};var b;g.forEach(function(t){var r=Object.getOwnPropertyDescriptor(e,t);var i;if(r.get||r.set){i={__get:r.get,__set:r.set}}else{i=e[t]}if(!n.isConstructor(i)&&!n.isSupermodelConstructor(i)&&n.isFunction(i)){if(!b){b={}}b[t]=i}else{m[t]=s(i)}});v.defs=m;v.proto=b}if(d===Array||n.isArray(d)){v.isArray=true;if(d.length>0){v.def=s(d[0])}}else if(g.length===0){v.isSimple=true}}v.create=i(v);return v}t.exports=s},{"./factory":6,"./util":11}],3:[function(e,t,r){"use strict";t.exports=function(e){var t=[];var r=function(){var r=Array.prototype.pop.apply(t);e("pop",t,{value:r});return r};var n=function(){var r=Array.prototype.push.apply(t,arguments);e("push",t,{value:r});return r};var i=function(){var r=Array.prototype.shift.apply(t);e("shift",t,{value:r});return r};var a=function(){var r=Array.prototype.sort.apply(t,arguments);e("sort",t,{value:r});return r};var s=function(){var r=Array.prototype.unshift.apply(t,arguments);e("unshift",t,{value:r});return r};var u=function(){var r=Array.prototype.reverse.apply(t);e("reverse",t,{value:r});return r};var o=function(){if(!arguments.length){return}var r=Array.prototype.splice.apply(t,arguments);e("splice",t,{value:r,removed:r,added:Array.prototype.slice.call(arguments,2)});return r};t.pop=t.pop&&r;t.push=t.push&&n;t.shift=t.shift&&i;t.unshift=t.unshift&&s;t.sort=t.sort&&a;t.reverse=t.reverse&&u;t.splice=t.splice&&o;t.update=function(r,n){var i=t[r];var a=t[r]=n;e("update",t,{index:r,value:a,oldValue:i});return a};return t}},{}],4:[function(e,t,r){"use strict";t.exports=function e(t,r,n,i){this.name=t;this.path=r;this.target=n;if(i){this.detail=i}}},{}],5:[function(e,t,r){"use strict";t.exports=n;function n(e){var t=e||this;if(e){t=i(e);return t}}function i(e){for(var t in n.prototype){e[t]=n.prototype[t]}return e}n.prototype.on=n.prototype.addEventListener=function(e,t){(this.__callbacks[e]=this.__callbacks[e]||[]).push(t);return this};n.prototype.once=function(e,t){function r(){this.off(e,r);t.apply(this,arguments)}r.fn=t;this.on(e,r);return this};n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(0===arguments.length){this.__callbacks={};return this}var r=this.__callbacks[e];if(!r){return this}if(1===arguments.length){delete this.__callbacks[e];return this}var n;for(var i=0;i<r.length;i++){n=r[i];if(n===t||n.fn===t){r.splice(i,1);break}}return this};n.prototype.emit=function(e){var t=[].slice.call(arguments,1),r=this.__callbacks[e];if(r){r=r.slice(0);for(var n=0,i=r.length;n<i;++n){r[n].apply(this,t)}}return this};n.prototype.listeners=function(e){return this.__callbacks[e]||[]};n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],6:[function(e,t,r){"use strict";var n=e("./util");var i=e("./proto");var a=e("./wrapper");function s(e,t){var r={};var n={__:{value:r},__def:{value:e},__parent:{value:t,writable:true},__callbacks:{value:{},writable:true}};return n}function u(e){var t=e.__def.defs;for(var r in t){o(e,r,t[r])}}function o(e,t,r){var n={get:function(){return this.__get(t)},enumerable:r.enumerable,configurable:r.configurable};if(r.writable){n.set=function(e){this.__setNotifyChange(t,e)}}Object.defineProperty(e,t,n);e.__[t]=r.create(e)}function f(e){var t,r,o;if(e.isSimple){t=new a(e.value,e.writable,e.validators,e.getter,e.cast,null)}else if(e.isReference){var f=e.type.def;if(f.isSimple){t=new a(f.value,f.writable,f.validators,e.getter,f.cast,null)}else{o=function(e){var t=false;if(n.isNullOrUndefined(e)){t=true}else{t=f===e.__def}if(!t){throw new Error("Value should be an instance of the referenced model, null or undefined")}};t=new a(e.value,e.writable,e.validators,e.getter,null,o)}}else if(e.isArray){r=function(t){var r=i(e);Object.defineProperties(r,s(e,t));u(r);return r};o=function(e){if(!n.isArray(e)){throw new Error("Value should be an array")}};t=new a(r,e.writable,e.validators,e.getter,null,o)}else{var l=i(e);r=function(t){var r=Object.create(l,s(e,t));u(r);return r};o=function(e){if(!l.isPrototypeOf(e)){throw new Error("Invalid prototype")}};t=new a(r,e.writable,e.validators,e.getter,null,o)}var c=function(e){var r=Object.create(t);r.initialize(e);return r};c.wrapper=t;return c}t.exports=f},{"./proto":8,"./util":11,"./wrapper":13}],7:[function(e,t,r){"use strict";var n=e("./emitter-event");var i=e("./validation-error");var a=e("./wrapper");var s={__supermodel:{value:true},__keys:{get:function(){var e=Object.keys(this);if(Array.isArray(this)){var t=["addEventListener","on","once","removeEventListener","removeAllListeners","removeListener","off","emit","listeners","hasListeners","pop","push","reverse","shift","sort","splice","update","unshift","create","__setNotifyChange","__notifyChange","__set","__get","__chain","__relativePath"];e=e.filter(function(e){return t.indexOf(e)<0})}return e}},__name:{get:function(){if(this.__isRoot){return""}var e=this.__parent.__keys;var t,r,n;for(var i=0;i<e.length;i++){t=e[i];r=this.__parent[t];n=Array.isArray(r);if(r===this){return t}}}},__path:{get:function(){if(this.__hasAncestors&&!this.__parent.__isRoot){return this.__parent.__path+"."+this.__name}else{return this.__name}}},__isRoot:{get:function(){return!this.__hasAncestors}},__children:{get:function(){var e=[];var t=this.__keys;var r,n;for(var i=0;i<t.length;i++){r=t[i];n=this[r];if(n&&n.__supermodel){e.push(n)}}return e}},__ancestors:{get:function(){var e=[],t=this;while(t.__parent){e.push(t.__parent);t=t.__parent}return e}},__descendants:{get:function(){var e=[];function t(r){var n=r.__keys;var i,a;for(var s=0;s<n.length;s++){i=n[s];a=r[i];if(a&&a.__supermodel){e.push(a);t(a)}}}t(this);return e}},__hasAncestors:{get:function(){return!!this.__ancestors.length}},__hasDescendants:{get:function(){return!!this.__descendants.length}},errors:{get:function(){var e=[],t=this.__def;var r,n,s,u;var o=t.validators.slice(0);for(s=0;s<o.length;s++){r=o[s];n=r.call(this,this);if(n){e.push(new i(this,n,r))}}var f=this.__keys;var l,c,p;for(s=0;s<f.length;s++){c=f[s];if(t.isArray&&t.def&&(!t.defs||!(c in t.defs))){p=t.def;if(p.isSimple){l=p.create.wrapper;l.setValue(this[c])}else if(p.isReference&&p.type.def.isSimple){l=p.type.def.create.wrapper;l.setValue(this[c])}else{l=this[c]}}else{l=this.__[c]}if(l){if(l.__supermodel){Array.prototype.push.apply(e,l.errors)}else if(l instanceof a){var _=l.getValue(this);if(!l._assert){var h=l.validators;for(u=0;u<h.length;u++){r=h[u];n=r.call(this,_,c);if(n){e.push(new i(this,n,r,c))}}}else if(_&&_.__supermodel){Array.prototype.push.apply(e,_.errors)}else{throw"just checking"}}}}return e}}};var u={__get:function(e){return this.__[e].getValue(this)},__set:function(e,t){this.__[e].setValue(t,this)},__relativePath:function(e,t){var r=this.__path?e.substr(this.__path.length+1):e;if(r){return t?r+"."+t:r}return t},__chain:function(e){return[this].concat(this.__ancestors).forEach(e)},__notifyChange:function(e,t,r){var i=this;var a=this.__path;var s="set";var u={oldValue:r,newValue:t};this.emit(s,new n(s,e,i,u));this.emit("change",new n(s,e,i,u));this.__ancestors.forEach(function(t){var r=t.__relativePath(a,e);t.emit("change",new n(s,r,i,u))})},__setNotifyChange:function(e,t){var r=this.__get(e);this.__set(e,t);var n=this.__get(e);this.__notifyChange(e,n,r)}};t.exports={proto:u,descriptors:s}},{"./emitter-event":4,"./validation-error":12,"./wrapper":13}],8:[function(e,t,r){"use strict";var n=e("./emitter-object");var i=e("./emitter-array");var a=e("./emitter-event");var s=e("./util").extend;var u=e("./model");var o=u.proto;var f=u.descriptors;var l=Object.create(o,f);var c=function(){var e=Object.create(l);n(e);return e}();function p(){var e=i(function(e,t,r){if(e==="update"){t.__notifyChange(r.index,r.value,r.oldValue)}else{var n=t;var i=t.__path;var s=r;var u=r.index;t.emit(e,new a(e,"",n,s));t.emit("change",new a(e,"",n,s));t.__ancestors.forEach(function(t){var r=t.__relativePath(i,u);t.emit("change",new a(e,r,n,s))})}});Object.defineProperties(e,f);n(e);s(e,o);return e}function _(e){var t=Object.create(c);if(e){s(t,e)}return t}function h(e,t){var r=p();if(e){s(r,e)}if(t){var n=t.create.wrapper;d(r,n);r.create=function(){return t.isReference?t.type():t.create().getValue(this)}}return r}function v(e,t){var r=[];for(var n=0;n<t.length;n++){e.setValue(t[n],e._parent);r.push(e.getValue(e._parent))}return r}function d(e,t){t._parent=e;var r=e.push;var n=e.unshift;var i=e.splice;var a=e.update;if(r){e.push=function(){var n=v(t,arguments);return r.apply(e,n)}}if(n){e.unshift=function(){var r=v(t,arguments);return n.apply(e,r)}}if(i){e.splice=function(){var r=v(t,Array.prototype.slice.call(arguments,2));r.unshift(arguments[1]);r.unshift(arguments[0]);return i.apply(e,r)}}if(a){e.update=function(){var r=v(t,[arguments[1]]);r.unshift(arguments[0]);return a.apply(e,r)}}}function y(e){return e.isArray?h(e.proto,e.def):_(e.proto)}t.exports=y},{"./emitter-array":3,"./emitter-event":4,"./emitter-object":5,"./model":7,"./util":11}],9:[function(e,t,r){"use strict";t.exports={}},{}],10:[function(e,t,r){"use strict";var n=e("./def");var i=e("./supermodel");function a(e,t){var r=n(e);function a(){var e=r.isSimple?r.create():r.create().getValue({});if(t){t.apply(e,arguments)}return e}Object.defineProperty(a,"def",{value:r});a.prototype=i;a.constructor=a;return a}t.exports=a},{"./def":2,"./supermodel":9}],11:[function(e,t,r){"use strict";var n=e("./supermodel");function i(e,t){if(!t||typeof t!=="object"){return e}var r=Object.keys(t);var n=r.length;while(n--){e[r[n]]=t[r[n]]}return e}var a={extend:i,typeOf:function(e){return Object.prototype.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},isObject:function(e){return this.typeOf(e)==="object"},isArray:function(e){return Array.isArray(e)},isSimple:function(e){return!this.isObject(e)&&!this.isArray(e)},isFunction:function(e){return this.typeOf(e)==="function"},isDate:function(e){return this.typeOf(e)==="date"},isNull:function(e){return e===null},isUndefined:function(e){return typeof e==="undefined"},isNullOrUndefined:function(e){return this.isNull(e)||this.isUndefined(e)},cast:function(e,t){if(!t){return e}switch(t){case String:return a.castString(e);case Number:return a.castNumber(e);case Boolean:return a.castBoolean(e);case Date:return a.castDate(e);case Object:case Function:return e;default:throw new Error("Invalid cast")}},castString:function(e){if(e===undefined||e===null||a.typeOf(e)==="string"){return e}return e.toString&&e.toString()},castNumber:function(e){if(e===undefined||e===null){return NaN}if(a.typeOf(e)==="number"){return e}return Number(e)},castBoolean:function(e){if(!e){return false}var t=["0","false","off","no"];return t.indexOf(e)===-1},castDate:function(e){if(e===undefined||e===null||a.typeOf(e)==="date"){return e}return new Date(e)},isConstructor:function(e){return this.isSimpleConstructor(e)||[Array,Object].indexOf(e)>-1},isSimpleConstructor:function(e){return[String,Number,Date,Boolean].indexOf(e)>-1},isSupermodelConstructor:function(e){return this.isFunction(e)&&e.prototype===n}};t.exports=a},{"./supermodel":9}],12:[function(e,t,r){"use strict";function n(e,t,r,n){this.target=e;this.error=t;this.validator=r;if(n){this.key=n}}t.exports=n},{}],13:[function(e,t,r){"use strict";var n=e("./util");function i(e,t,r,i,a,s){this.validators=r;this._defaultValue=e;this._writable=t;this._getter=i;this._beforeSet=a;this._assert=s;this.isInitialized=false;if(!n.isFunction(e)){this.isInitialized=true;if(!n.isUndefined(e)){this._value=e}}}i.prototype.initialize=function(e){if(this.isInitialized){return}this.setValue(this._defaultValue(e),e);this.isInitialized=true};i.prototype.getValue=function(e){return this._getter?this._getter.call(e):this._value};i.prototype.setValue=function(e,t){if(!this._writable){throw new Error("Value is readonly")}if(e&&e.__supermodel&&t){if(e.__parent!==t){e.__parent=t}}var r=this._beforeSet?this._beforeSet(e):e;if(this._assert){this._assert(r)}this._value=r};t.exports=i},{"./util":11}]},{},[1])(1)});