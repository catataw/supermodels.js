!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.supermodels=e()}}(function(){var e,t,r;return function e(t,r,n){function i(a,u){if(!r[a]){if(!t[a]){var o=typeof require=="function"&&require;if(!u&&o)return o(a,!0);if(s)return s(a,!0);var f=new Error("Cannot find module '"+a+"'");throw f.code="MODULE_NOT_FOUND",f}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){var r=t[a][1][e];return i(r?r:e)},l,l.exports,e,t,r,n)}return r[a].exports}var s=typeof require=="function"&&require;for(var a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,r){t.exports=e("./lib/supermodels")},{"./lib/supermodels":11}],2:[function(e,t,r){"use strict";var n=e("./util");var i=e("./factory");function s(e){var t=n.isConstructor(e);var r=n.isSupermodelConstructor(e);var i=n.isArray(e);if(t||r||i){return{__type:e}}var s=!n.isObject(e);if(s){return{__value:e}}return e}function a(e){e=s(e);var t="__validators";var r="__value";var u="__type";var o="__displayName";var f="__get";var l="__set";var c="__enumerable";var p="__configurable";var _="__writable";var h=[t,r,u,o,f,l,c,p,_];var v={from:e,type:e[u],value:e[r],validators:e[t]||[],enumerable:e[c]!==false,configurable:!!e[p],writable:e[_]!==false,displayName:e[o],getter:e[f],setter:e[l]};var d=v.type;if(n.isSimpleConstructor(d)){v.isSimple=true;v.cast=function(e){return n.cast(e,d)}}else if(n.isSupermodelConstructor(d)){v.isReference=true}else if(v.value){v.isSimple=true}else{var y=Object.keys(e);var g=y.filter(function(e){return h.indexOf(e)===-1});if(g.length){var m={};var b;g.forEach(function(t){var r=Object.getOwnPropertyDescriptor(e,t);var i;if(r.get||r.set){i={__get:r.get,__set:r.set}}else{i=e[t]}if(!n.isConstructor(i)&&!n.isSupermodelConstructor(i)&&n.isFunction(i)){if(!b){b={}}b[t]=i}else{m[t]=a(i)}});v.defs=m;v.proto=b}if(d===Array||n.isArray(d)){v.isArray=true;if(d.length>0){v.def=a(d[0])}}else if(g.length===0){v.isSimple=true}}v.create=i(v);return v}t.exports=a},{"./factory":6,"./util":12}],3:[function(e,t,r){"use strict";t.exports=function(e){var t=[];var r=function(){var r=Array.prototype.pop.apply(t);e("pop",t,{value:r});return r};var n=function(){var r=Array.prototype.push.apply(t,arguments);e("push",t,{value:r});return r};var i=function(){var r=Array.prototype.shift.apply(t);e("shift",t,{value:r});return r};var s=function(){var r=Array.prototype.sort.apply(t,arguments);e("sort",t,{value:r});return r};var a=function(){var r=Array.prototype.unshift.apply(t,arguments);e("unshift",t,{value:r});return r};var u=function(){var r=Array.prototype.reverse.apply(t);e("reverse",t,{value:r});return r};var o=function(){if(!arguments.length){return}var r=Array.prototype.splice.apply(t,arguments);e("splice",t,{value:r,removed:r,added:Array.prototype.slice.call(arguments,2)});return r};t.pop=t.pop&&r;t.push=t.push&&n;t.shift=t.shift&&i;t.unshift=t.unshift&&a;t.sort=t.sort&&s;t.reverse=t.reverse&&u;t.splice=t.splice&&o;t.update=function(r,n){var i=t[r];var s=t[r]=n;e("update",t,{index:r,value:s,oldValue:i});return s};return t}},{}],4:[function(e,t,r){"use strict";t.exports=function e(t,r,n,i){this.name=t;this.path=r;this.target=n;if(i){this.detail=i}}},{}],5:[function(e,t,r){"use strict";t.exports=n;function n(e){var t=e||this;if(e){t=i(e);return t}}function i(e){for(var t in n.prototype){e[t]=n.prototype[t]}return e}n.prototype.on=n.prototype.addEventListener=function(e,t){(this.__callbacks[e]=this.__callbacks[e]||[]).push(t);return this};n.prototype.once=function(e,t){function r(){this.off(e,r);t.apply(this,arguments)}r.fn=t;this.on(e,r);return this};n.prototype.off=n.prototype.removeEventListener=n.prototype.removeAllListeners=function(e,t){if(arguments.length===0){this.__callbacks={};return this}var r=this.__callbacks[e];if(!r){return this}if(arguments.length===1){delete this.__callbacks[e];return this}var n;for(var i=0;i<r.length;i++){n=r[i];if(n===t||n.fn===t){r.splice(i,1);break}}return this};n.prototype.emit=function(e){var t=[].slice.call(arguments,1);var r=this.__callbacks[e];if(r){r=r.slice(0);for(var n=0,i=r.length;n<i;++n){r[n].apply(this,t)}}return this};n.prototype.listeners=function(e){return this.__callbacks[e]||[]};n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],6:[function(e,t,r){"use strict";var n=e("./util");var i=e("./proto");var s=e("./wrapper");function a(e,t){var r={};var n={__:{value:r},__def:{value:e},__parent:{value:t,writable:true},__callbacks:{value:{},writable:true}};return n}function u(e){var t=e.__def.defs;for(var r in t){o(e,r,t[r])}}function o(e,t,r){var n={get:function(){return this.__get(t)},enumerable:r.enumerable,configurable:r.configurable};if(r.writable){n.set=function(e){this.__setNotifyChange(t,e)}}Object.defineProperty(e,t,n);e.__[t]=r.create(e)}function f(e){var t,r,o;if(e.isSimple){t=new s(e.value,e.writable,e.validators,e.getter,e.setter,e.cast,null)}else if(e.isReference){var f=e.type.def;if(f.isSimple){t=new s(f.value,f.writable,f.validators,e.getter,e.setter,f.cast,null)}else{o=function(e){var t=false;if(n.isNullOrUndefined(e)){t=true}else{t=f===e.__def}if(!t){throw new Error("Value should be an instance of the referenced model, null or undefined")}};t=new s(e.value,e.writable,e.validators,e.getter,e.setter,null,o)}}else if(e.isArray){r=function(t){var r=i(e);Object.defineProperties(r,a(e,t));u(r);return r};o=function(e){if(!n.isArray(e)){throw new Error("Value should be an array")}};t=new s(r,e.writable,e.validators,e.getter,e.setter,null,o)}else{var l=i(e);r=function(t){var r=Object.create(l,a(e,t));u(r);return r};o=function(e){if(!l.isPrototypeOf(e)){throw new Error("Invalid prototype")}};t=new s(r,e.writable,e.validators,e.getter,e.setter,null,o)}var c=function(e){var r=Object.create(t);r.initialize(e);return r};c.wrapper=t;return c}t.exports=f},{"./proto":9,"./util":12,"./wrapper":14}],7:[function(e,t,r){"use strict";function n(e,t){var r=e.__def.isArray;var i=e.__def.defs;var s,a,u,o,f,l,c;if(i){s=Object.keys(i);for(o=0;o<s.length;o++){u=s[o];if(t.hasOwnProperty(u)){a=i[u];f=a.isSimple;l=a.isReference&&a.type.def.isSimple;c=a.isReference&&t[u]&&t[u].__supermodel;if(f||l||c){e[u]=t[u]}else if(t[u]){if(a.isReference){e[u]=a.type()}n(e[u],t[u])}}}}if(r&&Array.isArray(t)){for(o=0;o<t.length;o++){var p=e.create();e.push(p&&p.__supermodel?n(p,t[o]):t[o])}}return e}t.exports=n},{}],8:[function(e,t,r){"use strict";var n=e("./emitter-event");var i=e("./validation-error");var s=e("./wrapper");var a=e("./merge");var u={__supermodel:{value:true},__keys:{get:function(){var e=Object.keys(this);if(Array.isArray(this)){var t=["addEventListener","on","once","removeEventListener","removeAllListeners","removeListener","off","emit","listeners","hasListeners","pop","push","reverse","shift","sort","splice","update","unshift","create","__merge","__setNotifyChange","__notifyChange","__set","__get","__chain","__relativePath"];e=e.filter(function(e){return t.indexOf(e)<0})}return e}},__name:{get:function(){if(this.__isRoot){return""}var e=this.__parent.__keys;var t,r;for(var n=0;n<e.length;n++){t=e[n];r=this.__parent[t];if(r===this){return t}}}},__path:{get:function(){if(this.__hasAncestors&&!this.__parent.__isRoot){return this.__parent.__path+"."+this.__name}else{return this.__name}}},__isRoot:{get:function(){return!this.__hasAncestors}},__children:{get:function(){var e=[];var t=this.__keys;var r,n;for(var i=0;i<t.length;i++){r=t[i];n=this[r];if(n&&n.__supermodel){e.push(n)}}return e}},__ancestors:{get:function(){var e=[];var t=this;while(t.__parent){e.push(t.__parent);t=t.__parent}return e}},__descendants:{get:function(){var e=[];function t(r){var n=r.__keys;var i,s;for(var a=0;a<n.length;a++){i=n[a];s=r[i];if(s&&s.__supermodel){e.push(s);t(s)}}}t(this);return e}},__hasAncestors:{get:function(){return!!this.__ancestors.length}},__hasDescendants:{get:function(){return!!this.__descendants.length}},errors:{get:function(){var e=[];var t=this.__def;var r,n,a,u;var o=t.validators.slice(0);for(a=0;a<o.length;a++){r=o[a];n=r.call(this,this);if(n){e.push(new i(this,n,r))}}var f=this.__keys;var l,c,p;for(a=0;a<f.length;a++){c=f[a];if(t.isArray&&t.def&&(!t.defs||!(c in t.defs))){p=t.def;if(p.isSimple){l=p.create.wrapper;l.setValue(this[c])}else if(p.isReference&&p.type.def.isSimple){l=p.type.def.create.wrapper;l.setValue(this[c])}else{l=this[c]}}else{l=this.__[c]}if(l){if(l.__supermodel){Array.prototype.push.apply(e,l.errors)}else if(l instanceof s){var _=l.getValue(this);if(_&&_.__supermodel){Array.prototype.push.apply(e,_.errors)}else{var h=l.validators;for(u=0;u<h.length;u++){r=h[u];n=r.call(this,_,c);if(n){e.push(new i(this,n,r,c))}}}}}}return e}}};var o={__get:function(e){return this.__[e].getValue(this)},__set:function(e,t){this.__[e].setValue(t,this)},__relativePath:function(e,t){var r=this.__path?e.substr(this.__path.length+1):e;if(r){return t?r+"."+t:r}return t},__chain:function(e){return[this].concat(this.__ancestors).forEach(e)},__merge:function(e){return a(this,e)},__notifyChange:function(e,t,r){var i=this;var s=this.__path;var a="set";var u={oldValue:r,newValue:t};this.emit(a,new n(a,e,i,u));this.emit("change",new n(a,e,i,u));this.emit("change:"+e,new n(a,e,i,u));this.__ancestors.forEach(function(t){var r=t.__relativePath(s,e);t.emit("change",new n(a,r,i,u))})},__setNotifyChange:function(e,t){var r=this.__get(e);this.__set(e,t);var n=this.__get(e);this.__notifyChange(e,n,r)}};t.exports={proto:o,descriptors:u}},{"./emitter-event":4,"./merge":7,"./validation-error":13,"./wrapper":14}],9:[function(e,t,r){"use strict";var n=e("./emitter-object");var i=e("./emitter-array");var s=e("./emitter-event");var a=e("./util").extend;var u=e("./model");var o=u.proto;var f=u.descriptors;var l=Object.create(o,f);var c=function(){var e=Object.create(l);n(e);return e}();function p(){var e=i(function(e,t,r){if(e==="update"){t.__notifyChange(r.index,r.value,r.oldValue)}else{var n=t;var i=t.__path;var a=r;var u=r.index;t.emit(e,new s(e,"",n,a));t.emit("change",new s(e,"",n,a));t.__ancestors.forEach(function(t){var r=t.__relativePath(i,u);t.emit("change",new s(e,r,n,a))})}});Object.defineProperties(e,f);n(e);a(e,o);return e}function _(e){var t=Object.create(c);if(e){a(t,e)}return t}function h(e,t){var r=p();if(e){a(r,e)}if(t){var n=t.create.wrapper;v(r,n);r.create=function(){return t.isReference?t.type():t.create().getValue(this)}}return r}function v(e,t){function r(r){var n=[];for(var i=0;i<r.length;i++){t.setValue(r[i],e);n.push(t.getValue(e))}return n}var n=e.push;var i=e.unshift;var s=e.splice;var a=e.update;if(n){e.push=function(){var t=r(arguments);return n.apply(e,t)}}if(i){e.unshift=function(){var t=r(arguments);return i.apply(e,t)}}if(s){e.splice=function(){var t=r(Array.prototype.slice.call(arguments,2));t.unshift(arguments[1]);t.unshift(arguments[0]);return s.apply(e,t)}}if(a){e.update=function(){var t=r([arguments[1]]);t.unshift(arguments[0]);return a.apply(e,t)}}}function d(e){return e.isArray?h(e.proto,e.def):_(e.proto)}t.exports=d},{"./emitter-array":3,"./emitter-event":4,"./emitter-object":5,"./model":8,"./util":12}],10:[function(e,t,r){"use strict";t.exports={}},{}],11:[function(e,t,r){"use strict";var n=e("./def");var i=e("./supermodel");function s(e,t){var r=n(e);function s(e){var n=r.isSimple?r.create():r.create().getValue({});if(t){t.apply(n,arguments)}else if(e){n.__merge(e)}return n}Object.defineProperty(s,"def",{value:r});s.prototype=i;s.constructor=s;return s}t.exports=s},{"./def":2,"./supermodel":10}],12:[function(e,t,r){"use strict";var n=e("./supermodel");function i(e,t){if(!t||typeof t!=="object"){return e}var r=Object.keys(t);var n=r.length;while(n--){e[r[n]]=t[r[n]]}return e}var s={extend:i,typeOf:function(e){return Object.prototype.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},isObject:function(e){return this.typeOf(e)==="object"},isArray:function(e){return Array.isArray(e)},isSimple:function(e){return!this.isObject(e)&&!this.isArray(e)},isFunction:function(e){return this.typeOf(e)==="function"},isDate:function(e){return this.typeOf(e)==="date"},isNull:function(e){return e===null},isUndefined:function(e){return typeof e==="undefined"},isNullOrUndefined:function(e){return this.isNull(e)||this.isUndefined(e)},cast:function(e,t){if(!t){return e}switch(t){case String:return s.castString(e);case Number:return s.castNumber(e);case Boolean:return s.castBoolean(e);case Date:return s.castDate(e);case Object:case Function:return e;default:throw new Error("Invalid cast")}},castString:function(e){if(e===undefined||e===null||s.typeOf(e)==="string"){return e}return e.toString&&e.toString()},castNumber:function(e){if(e===undefined||e===null){return NaN}if(s.typeOf(e)==="number"){return e}return Number(e)},castBoolean:function(e){if(!e){return false}var t=["0","false","off","no"];return t.indexOf(e)===-1},castDate:function(e){if(e===undefined||e===null||s.typeOf(e)==="date"){return e}return new Date(e)},isConstructor:function(e){return this.isSimpleConstructor(e)||[Array,Object].indexOf(e)>-1},isSimpleConstructor:function(e){return[String,Number,Date,Boolean].indexOf(e)>-1},isSupermodelConstructor:function(e){return this.isFunction(e)&&e.prototype===n}};t.exports=s},{"./supermodel":10}],13:[function(e,t,r){"use strict";function n(e,t,r,n){this.target=e;this.error=t;this.validator=r;if(n){this.key=n}}t.exports=n},{}],14:[function(e,t,r){"use strict";var n=e("./util");function i(e,t,r,i,s,a,u){this.validators=r;this._defaultValue=e;this._writable=t;this._getter=i;this._setter=s;this._beforeSet=a;this._assert=u;this.isInitialized=false;if(!n.isFunction(e)){this.isInitialized=true;if(!n.isUndefined(e)){this._value=e}}}i.prototype.initialize=function(e){if(this.isInitialized){return}this.setValue(this._defaultValue(e),e);this.isInitialized=true};i.prototype.getValue=function(e){return this._getter?this._getter.call(e):this._value};i.prototype.setValue=function(e,t){if(!this._writable){throw new Error("Value is readonly")}if(e&&e.__supermodel&&t){if(e.__parent!==t){e.__parent=t}}var r;if(this._setter){this._setter.call(t,e);r=this.getValue(t)}else{r=this._beforeSet?this._beforeSet(e):e}if(this._assert){this._assert(r)}this._value=r};t.exports=i},{"./util":12}]},{},[1])(1)});