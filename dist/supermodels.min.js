!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.supermodels=t()}}(function(){var t,r,n;return function t(e,r,n){function i(s,o){if(!r[s]){if(!e[s]){var u=typeof require=="function"&&require;if(!o&&u)return u(s,!0);if(a)return a(s,!0);throw new Error("Cannot find module '"+s+"'")}var f=r[s]={exports:{}};e[s][0].call(f.exports,function(t){var r=e[s][1][t];return i(r?r:t)},f,f.exports,t,e,r,n)}return r[s].exports}var a=typeof require=="function"&&require;for(var s=0;s<n.length;s++)i(n[s]);return i}({1:[function(t,e,r){var n=t("./lib/def");var i=t("./lib/proto");var a=t("./lib/supermodel");function s(t,e,r){var i=n(t);function s(){var t=i.create(r).value;if(e){e.apply(t,arguments)}return t}s.prototype=a;s.constructor=s;return s}e.exports=s},{"./lib/def":2,"./lib/proto":4,"./lib/supermodel":5}],2:[function(t,e,r){var n=t("./util");var i=t("./wrapper");function a(t){var e=n.isConstructor(t);var r=n.isArray(t);if(e||r){return{__type:t}}var i=!n.isObject(t);if(i){return{__value:t}}return t}function s(t){t=a(t);var e="__validators",r="__value",o="__type",u="__displayName",f="__get",c="__set",l="__enumerable",p="__configurable",v="__writable",h=[e,r,o,u,f,c,l,p,v];var _={from:t,type:t[o],value:t[r],validators:t[e]||[],enumerable:t[l]===false?false:true,configurable:t[p]?true:false,writable:t[v]===false?false:true,displayName:t[u],getter:t[f],setter:t[c]};var d=_.type;if(~[String,Number,Date,Boolean].indexOf(d)){_.isSimple=true;_.cast=function(t){return n.cast(t,d)}}else if(!_.value){var y=Object.keys(t);var g=y.filter(function(t){return h.indexOf(t)===-1});if(g.length){var m={};var b;g.forEach(function(e){var r=t[e];if(!n.isConstructor(r)&&n.isFunction(r)){if(!b){b={}}b[e]=r}else{m[e]=s(r)}});_.defs=m;_.proto=b}if(d===Array||n.isArray(d)){_.isArray=true;if(d.length>0){_.def=s(d[0])}}}_.create=i(_);return _}e.exports=s},{"./util":6,"./wrapper":8}],3:[function(t,r,n){var i=t("emitter-event");var a=t("./validation-error");var s={__supermodel:{value:true},__keys:{get:function(){var t=Object.keys(this);if(Array.isArray(this)){var e=["addEventListener","on","once","removeEventListener","removeAllListeners","removeListener","off","emit","listeners","hasListeners","pop","push","reverse","shift","sort","splice","update","unshift","create","__setNotifyChange","__notifyChange","__set","__get"];t=t.filter(function(t){return e.indexOf(t)<0})}return t}},__name:{get:function(){if(this.__isRoot){return""}var t=this.__parent.__keys;var e,r,n;for(var i=0;i<t.length;i++){e=t[i];r=this.__parent[e];n=Array.isArray(r);if(r===this){return e}}}},__path:{get:function(){if(this.__hasAncestors&&!this.__parent.__isRoot){return this.__parent.__path+"."+this.__name}else{return this.__name}}},__isRoot:{get:function(){return!this.__hasAncestors}},__children:{get:function(){var t=[];var e=this.__keys;var r,n;for(var i=0;i<e.length;i++){r=e[i];n=this[r];if(n&&n.__supermodel){t.push(n)}}return t}},__ancestors:{get:function(){var t=[],e=this;while(e.__parent){t.push(e.__parent);e=e.__parent}return t}},__descendants:{get:function(){var t=[];function e(r){var n=r.__keys;var i,a;for(var s=0;s<n.length;s++){i=n[s];a=r[i];if(a&&a.__supermodel){t.push(a);e(a)}}}e(this);return t}},__hasAncestors:{get:function(){return!!this.__ancestors.length}},__hasDecendants:{get:function(){return!!this.__descendants.length}},errors:{get:function(){var t=[];var e=this.__validators;var r,n,i,s,o;if(e){for(o=0;o<e.length;o++){r=e[o];n=r.key;i=r.test.call(this,n?this[n]:this,n);if(i){t.push(new a(this,i,r,n))}}}for(o=0;o<this.__children.length;o++){s=this.__children[o];Array.prototype.push.apply(t,s.errors)}return t}}};var o={__get:function(t){return this.__[t].value},__set:function(t,e){var r=this.__[t];this.__[t].value=e;var n=this.__get[t]},__notifyChange:function(t,e,r){this.emit("change",new i("change",this,{name:t,value:e,oldValue:r}));this.emit("change:"+t,new i("change:"+t,this,{value:e,oldValue:r}));var n;for(var a=0;a<this.__ancestors.length;a++){n=this.__path+"."+t;this.__ancestors[a].emit("change",new i("change",this,{name:n,value:e,oldValue:r}));this.__ancestors[a].emit("change:"+n,new i("change:"+n,this,{name:n,value:e,oldValue:r}))}},__setNotifyChange:function(t,r){this.__set(t,r);this.__notifyChange(t,e)}};r.exports={proto:o,descriptors:s}},{"./validation-error":7,"emitter-event":12}],4:[function(t,e,r){var n=t("emitter-object");var i=t("emitter-array");var a=t("./util").extend;var s=t("./model").proto;var o=t("./model").descriptors;var u=Object.create(s,o);var f=function(){var t=Object.create(u);n(t);return t}();function c(){var t=i(function(){});Object.defineProperties(t,o);n(t);a(t,s);return t}function l(t){if(t){return Object.create(a(t,f))}else{return Object.create(f)}}function p(t,e){var r=c();if(t){a(r,t)}if(e){var n=e.create.wrapper;h(r,n);if(!e.isSimple){r.create=function(){return e.create(this).value}}}return r}function v(t,e){var r=[],n;for(var i=0;i<e.length;i++){t.value=e[i];r.push(t.value)}return r}function h(t,e){var r=t.push;var n=t.unshift;var i=t.splice;if(r){t.push=function(){var n=v(e,arguments);return r.apply(t,n)}}if(n){t.unshift=function(){var r=v(e,arguments);return n.apply(t,r)}}if(i){t.splice=function(){var r=v(e,Array.prototype.slice.call(arguments,2));r.unshift(arguments[1]);r.unshift(arguments[0]);return i.apply(t,r)}}}function _(t){return t.isArray?p(t.proto,t.def):l(t.proto)}e.exports=_},{"./model":3,"./util":6,"emitter-array":9,"emitter-object":13}],5:[function(t,e,r){function n(){}},{}],6:[function(t,e,r){function n(t,e){if(!e||typeof e!=="object")return t;var r=Object.keys(e);var n=r.length;while(n--){t[r[n]]=e[r[n]]}return t}var i={extend:n,typeOf:function(t){return Object.prototype.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},isObject:function(t){return this.typeOf(t)==="object"},isArray:function(t){return Array.isArray(t)},isSimple:function(t){return!this.isObject(t)&&!this.isArray(t)},isFunction:function(t){return this.typeOf(t)==="function"},isDate:function(t){return this.typeOf(t)==="date"},isUndefined:function(t){return typeof t==="undefined"},cast:function(t,e){if(!e){return t}switch(e){case String:return i.castString(t);case Number:return i.castNumber(t);case Boolean:return i.castBoolean(t);case Date:return i.castDate(t);case Object:case Function:return t;default:throw new Error("Invalid cast")}},castString:function(t){if(t===undefined||t===null||i.typeOf(t)==="string"){return t}return t.toString&&t.toString()},castNumber:function(t){if(t===undefined||t===null){return NaN}if(i.typeOf(t)==="number"){return t}return Number(t)},castBoolean:function(t){if(!t){return false}var e=["0","false","off","no"];return e.indexOf(t)===-1},castDate:function(t){if(t===undefined||t===null||i.typeOf(t)==="date"){return t}return new Date(t)},isConstructor:function(t){return this.isSimpleConstructor(t)||~[Array,Object].indexOf(t)},isSimpleConstructor:function(t){return~[String,Number,Date,Boolean].indexOf(t)}};e.exports=i},{}],7:[function(t,e,r){function n(t,e,r,n){this.target=t;this.error=e;this.validator=r;if(n){this.key=n}}e.exports=n},{}],8:[function(t,e,r){var n=t("./util");var i=t("./proto");function a(t,e,r,i,a){this.validators=r;this._defaultValue=t;this._writable=e;this._cast=i;this._assert=a;if(!n.isFunction(t)){this.isInitialized=true;if(!n.isUndefined(t)){this.value=t}}}a.prototype.initialize=function(t){if(this.isInitialized){return}this.value=this._defaultValue(t);this.isInitialized=true};Object.defineProperties(a.prototype,{value:{get:function(){return this._getter?this._getter():this._value},set:function(t){if(!this._writable){throw new Error("readonly")}var e=this._cast?this._cast(t):t;if(this._assert){this._assert(e)}this._value=e}}});function s(t,e){var r={};var n={__:{value:r},__def:{value:t},__parent:{value:e}};return n}function o(t){var e=t.__def.defs;for(var r in e){u(t,r,e[r])}}function u(t,e,r){var n=r.cast;var i={get:function(){return this.__get(e)},enumerable:r.enumerable,configurable:r.configurable};if(r.writable){i.set=function(t){this.__setNotifyChange(e,t)}}Object.defineProperty(t,e,i);t.__[e]=r.create(t)}function f(t){var e;if(t.isSimple){e=new a(t.value,t.writable,t.validators,t.cast,null)}else if(t.isArray){var r=function(e){var r=i(t);Object.defineProperties(r,s(t,e));o(r);return r};var u=function(t){if(!n.isArray(t)){throw new Error("Value should be an array")}};e=new a(r,t.writable,t.validators,null,u)}else{var f=i(t);var r=function(e){var r=Object.create(f,s(t,e));o(r);return r};var u=function(t){if(!f.isPrototypeOf(t)){throw new Error("Invalid prototype")}};e=new a(r,t.writable,t.validators,null,u)}var c=function(t){var r=Object.create(e);if(!r.isInitialized){r.initialize(t)}return r};c.wrapper=e;return c}e.exports=f},{"./proto":4,"./util":6}],9:[function(t,e,r){var n=t("emitter-object");var i=t("emitter-event");function a(t,e,r){var n=new i(t,e,r);e.emit(t,n);e.emit("change",n)}e.exports=function(t){t=t||raiseEvent;var e=arguments;var r=[];if(!t)n(r);var i=function(){var e=Array.prototype.pop.apply(r);t("pop",r,{value:e});return e};var a=function(){var e=Array.prototype.push.apply(r,arguments);t("push",r,{value:e});return e};var s=function(){var e=Array.prototype.reverse.apply(r);t("reverse",r,{value:e});return e};var o=function(){var e=Array.prototype.shift.apply(r);t("shift",r,{value:e});return e};var u=function(){var e=Array.prototype.sort.apply(r,arguments);t("sort",r,{value:e});return e};var f=function(){var e=Array.prototype.unshift.apply(r,arguments);t("unshift",r,{value:e});return e};var c=function(){if(!arguments.length){return}var e=Array.prototype.splice.apply(r,arguments);t("splice",r,{value:e,removed:e,added:Array.prototype.slice.call(arguments,2)});return e};r.pop=r.pop&&i;r.push=r.push&&a;r.reverse=r.reverse&&s;r.shift=r.shift&&o;r.sort=r.sort&&u;r.splice=r.splice&&c;r.update=function(e,n){var i=r[e];var a=r[e]=n;t("update",r,{value:a,oldValue:i});return a};return r}},{"emitter-event":10,"emitter-object":11}],10:[function(t,e,r){e.exports=function t(e,r,n){this.name=e;this.target=r;if(n){this.detail=n}}},{}],11:[function(t,e,r){e.exports=n;function n(t){var e=t||this;var r;Object.defineProperty(e,"__callbacks",{get:function(){return r=r||{}},set:function(t){r=t}});if(t){e=i(t);return e}}function i(t){for(var e in n.prototype){t[e]=n.prototype[e]}return t}n.prototype.on=n.prototype.addEventListener=function(t,e){(this.__callbacks[t]=this.__callbacks[t]||[]).push(e);return this};n.prototype.once=function(t,e){function r(){this.off(t,r);e.apply(this,arguments)}r.fn=e;this.on(t,r);return this};n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){if(0==arguments.length){this.__callbacks={};return this}var r=this.__callbacks[t];if(!r)return this;if(1==arguments.length){delete this.__callbacks[t];return this}var n;for(var i=0;i<r.length;i++){n=r[i];if(n===e||n.fn===e){r.splice(i,1);break}}return this};n.prototype.emit=function(t){var e=[].slice.call(arguments,1),r=this.__callbacks[t];if(r){r=r.slice(0);for(var n=0,i=r.length;n<i;++n){r[n].apply(this,e)}}return this};n.prototype.listeners=function(t){return this.__callbacks[t]||[]};n.prototype.hasListeners=function(t){return!!this.listeners(t).length}},{}],12:[function(t,e,r){e.exports=t(10)},{}],13:[function(t,e,r){e.exports=t(11)},{}]},{},[1])(1)});